<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pi Sign Language Translator</title>
    <link rel="stylesheet" href="/static/styles.css">
    <link rel="stylesheet" href="/static/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <!-- Add TensorFlow.js -->
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@3.11.0/dist/tf.min.js"></script>
    <!-- Add MediaPipe Hands dependencies -->
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands@0.4.1646424915/hands.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils@0.3.1640029074/camera_utils.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils@0.3.1620248257/drawing_utils.min.js"></script>
    <!-- Add Pi Network SDK -->
    <script src="https://sdk.minepi.com/pi-sdk.js"></script>
    <script>
        // Initialize Pi SDK with sandbox mode for development
        window.Pi = {
            init: function(config) {
                console.log('Pi Network SDK initialized with config:', config);
                return Promise.resolve();
            },
            getUser: function() {
                return Promise.resolve({
                    username: 'Test User',
                    avatar: 'data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%2314CFF4"%3E%3Cpath d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/%3E%3C/svg%3E'
                });
            }
        };
    </script>
</head>
<body>
    <div class="container">
        <header>
            <h1>Pi Sign Language Translator</h1>
            <div class="user-profile">
                <div id="user-info" class="hidden">
                    <img id="user-avatar" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%2314CFF4'%3E%3Cpath d='M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z'/%3E%3C/svg%3E" alt="User Avatar">
                    <span id="username">Loading...</span>
                </div>
                <button id="connect-pi" class="pi-button">Connect Pi Account</button>
            </div>
        </header>

        <main>
            <div class="camera-section">
                <div class="camera-container">
                    <video id="camera-feed" autoplay playsinline></video>
                    <div class="camera-overlay">
                        <div class="hand-detection-box"></div>
                    </div>
                </div>
                <div class="camera-controls">
                    <button id="switch-camera" class="control-button">
                        <span class="icon">ðŸ”„</span> Switch Camera
                    </button>
                    <button id="toggle-camera" class="control-button">
                        <span class="icon">ðŸ“·</span> Toggle Camera
                    </button>
                    <!-- Add Test Button -->
                    <button id="test-landmarks" class="control-button">
                        <span class="icon">ðŸ§ª</span> Test with "A" Sign
                    </button>
                </div>
            </div>

            <div class="detection-section">
                <h2>Detected Sign</h2>
                <div id="sign-output" class="output-box">Loading...</div>
            </div>
        </main>

        <footer>
            <div class="footer-links">
                <a href="learn.html" class="footer-link">Learn Sign Language</a>
                <p class="footer-text">Powered by Pi Network & AI Technology</p>
                <a href="premium.html" class="footer-link">Premium Subscription</a>
            </div>
        </footer>
    </div>

    <script src="/static/auth.js"></script>
    <script>
      // Load class indices from the server
      let labelMap = {};
      fetch('/models/index_to_class.json')
        .then(response => response.json())
        .then(data => {
          console.log("Loaded class indices:", data);
          // Convert from string keys to number keys
          labelMap = Object.entries(data).reduce((acc, [key, value]) => {
            acc[parseInt(key)] = value;
            return acc;
          }, {});
          console.log("Processed label map:", labelMap);
        })
        .catch(error => {
          console.error("Error loading class indices:", error);
        });
    </script>
    <script src="/static/app.js"></script>
</body>
</html>